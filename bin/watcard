#!/usr/bin/env ruby

require "watcard"
require "yaml"

FILE = File.expand_path("~/.watcard.yml")

begin
  yaml_dat = IO.read(FILE)
  conf = YAML.load(yaml_dat)
rescue Exception => e
  STDERR.puts "Can't load config file"
  p e
  STDERR.puts e.message
end

command = ARGV.shift
days_ago = (ARGV.shift || 0).to_i
hist = Watcard::History.new(conf)
case command
when "hist"
  hist.output_history(days_ago)
when "ledger"
  hist.output_ledger(days_ago)
when "ledgerall"
  hist.output_ledger_all
when "rawhist"
  hist.output_raw_history(days_ago)
when "lastadd"
  date = hist.last_ledger_add
  puts "#{(Date.today-date).to_i} days ago on #{date}"
else
  puts "Watcard CLI v#{Watcard::VERSION}"
  puts "By Tristan Hume"
  puts ""
  puts "Unknown command"
end
